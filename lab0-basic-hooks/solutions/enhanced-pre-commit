#!/bin/sh
# Enhanced pre-commit hook with better error messages

echo "Running pre-commit checks..."

# Check for trailing whitespace
if git rev-parse --verify HEAD >/dev/null 2>&1
then
    against=HEAD
else
    # Initial commit: diff against an empty tree object
    against=4b825dc642cb6eb9a060e54bf8d69288fbee4904
fi

# Find files with trailing whitespace
bad_files=$(git diff-index --check --cached $against)

if [ "$bad_files" ]; then
    echo "Error: Found trailing whitespace in the following files:"
    echo "$bad_files"
    echo ""
    echo "Please remove trailing whitespace and try again."
    echo "You can fix this automatically with:"
    echo "  git diff --cached --name-only | xargs sed -i 's/[[:space:]]*$//'"
    exit 1
fi

echo "Pre-commit checks passed!"
exit 0