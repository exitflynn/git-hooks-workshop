#!/usr/bin/env python3
"""
Lightweight post-checkout hook for basic dependency installation.

This is a simpler version that just installs from requirements.txt
when switching branches.
"""

import os
import sys
import subprocess
from pathlib import Path

def get_git_root():
    """Get the root directory of the git repository."""
    try:
        result = subprocess.run(
            ['git', 'rev-parse', '--show-toplevel'],
            capture_output=True,
            text=True,
            check=True
        )
        return Path(result.stdout.strip())
    except subprocess.CalledProcessError:
        return None

def install_requirements(git_root):
    """Install Python requirements if requirements.txt exists."""
    req_file = git_root / 'requirements.txt'
    
    if req_file.exists():
        print("Installing dependencies from requirements.txt...")
        try:
            subprocess.run([
                sys.executable, '-m', 'pip', 'install', '-r', 'requirements.txt'
            ], cwd=git_root, check=True)
            print("Dependencies installed successfully!")
        except subprocess.CalledProcessError as e:
            print(f"Failed to install dependencies: {e}")
            return False
    
    return True

def main():
    """Main post-checkout hook execution."""
    # Parse hook arguments  
    if len(sys.argv) != 4:
        sys.exit(0)
    
    # Only run on branch checkouts
    if sys.argv[3] != '1':
        sys.exit(0)
    
    git_root = get_git_root()
    if not git_root:
        sys.exit(0)
    
    install_requirements(git_root)

if __name__ == '__main__':
    main()